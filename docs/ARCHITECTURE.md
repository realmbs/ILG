# ILG Architecture Overview

## System Diagram

```
User Input (vertical + geography + ICP)
        |
        v
+---------------------+
|  Vertical Adapter    |  <- Translates user input into structured research config
|  (Claude reasoning)  |
+--------+------------+
         |  generates: org_types, role_targets, signal_taxonomy,
         |             keyword_sets, subreddit_list, scoring_weights
         v
+---------------------+
|  n8n Orchestration   |  <- Executes pipeline stages in sequence
|  (self-hosted)       |
+--------+------------+
         |  triggers stages 1-5
         v
+---------------------------------------------+
|  Stage 1: Org Discovery                      |
|  Stage 2: Contact Extraction                 |
|  Stage 3: Signal Collection (LI/Reddit/X)    |
|  Stage 4: Sentiment Analysis & Enrichment    |
|  Stage 5: Scoring & Export                   |
+----------------------------------------------+
         |
         v
    SQLite DB -> CSV / Google Sheets export
```

## Pipeline Stages

| Stage | Skill | Agent | MCP Servers | Output |
|-------|-------|-------|-------------|--------|
| 1. Org Discovery | org-discoverer | org-discovery-agent | Playwright | organizations table |
| 2. Contact Extraction | contact-extractor | enrichment-agent | Playwright, LinkedIn | contacts table |
| 3. Signal Collection | — | sentiment-agent | Reddit, Twitter, LinkedIn | signals table (raw) |
| 4. Sentiment Analysis | sentiment-classifier | sentiment-agent | — | signals table (analyzed) |
| 5. Scoring & Export | lead-scorer | scoring-agent | Filesystem | lead_scores table + CSV |

## Key Concept: Vertical Config

The `vertical_config` JSON object is the contract between all pipeline stages. Generated by the vertical-adapter skill from natural language input, it contains:

- **org_discovery**: What types of orgs to find and where to look
- **contact_targeting**: Which roles to prioritize and how many per org
- **signal_taxonomy**: What social media signals mean for this vertical
- **social_monitoring**: Keywords, subreddits, and hashtags to monitor
- **scoring**: How to weight signals, roles, and recency

Switching verticals requires zero code changes — only a new config.

## Technology Stack

| Layer | Technology | Purpose |
|-------|-----------|---------|
| Orchestration | n8n (Docker) | Workflow execution and scheduling |
| Intelligence | Claude Code + skills + agents | Analysis, classification, scoring |
| Data Bridge | MCP servers | Web scraping, API access, file I/O |
| Storage | SQLite (MVP) | All persistent data |
| Output | CSV export | Lead lists for manual outreach |

## File Organization

- `claude-skills/*.md` — Instruction files that define Claude's behavior for each task
- `claude-agents/*.yaml` — Declarative configs composing skills + MCP servers
- `mcp-servers/*/` — Custom MCP server implementations (Phase 2)
- `db/` — Database schema and initialization
- `config/default-verticals/` — Pre-built vertical configs
- `scripts/` — Setup, backup, and export utilities
- `n8n-workflows/` — Exported n8n workflow definitions

For the complete specification, see [PLAN.md](../PLAN.md).
